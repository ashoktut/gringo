<div class="search-container" [class]="getContainerClasses()">
  <mat-form-field appearance="outline" class="search-field" [class.mat-focused]="isFocused">
    <mat-label>{{ config.placeholder || 'Search...' }}</mat-label>
    <input
      matInput
      [formControl]="searchControl"
      [placeholder]="config.placeholder || 'Search...'"
      type="text"
      (focus)="onFocus()"
      (blur)="onBlur()"
      (keydown.enter)="onEnterPressed()"
      (keydown.escape)="onEscapePressed()"
      #searchInput
      >
      <mat-icon matPrefix [class.search-loading]="isLoading">
        {{ isLoading ? 'sync' : 'search' }}
      </mat-icon>

      @if (config.showClearButton && searchControl.value) {
        <button
          mat-icon-button
          matSuffix
          (click)="clearSearch()"
          type="button"
          aria-label="Clear search"
          class="clear-button">
          <mat-icon>close</mat-icon>
        </button>
      }
    </mat-form-field>

    <!-- Search Hint -->
    @if (showHint && isFocused) {
      <div class="search-hint">
        <mat-icon>lightbulb</mat-icon>
        {{ getSearchHint() }}
      </div>
    }

    <!-- Search Suggestions Dropdown -->
    @if (showSuggestions && suggestions.length > 0) {
      <div class="search-suggestions">
        @for (suggestion of suggestions; track trackSuggestion($index, suggestion)) {
          <div
            class="search-suggestion"
            (click)="selectSuggestion(suggestion)"
            [attr.aria-label]="'Select suggestion: ' + suggestion.text">
            <mat-icon>{{ suggestion.icon || 'search' }}</mat-icon>
            <span>{{ suggestion.text }}</span>
            @if (suggestion.category) {
              <mat-icon class="suggestion-arrow">arrow_forward</mat-icon>
            }
          </div>
        }
      </div>
    }

    <!-- No Results Message -->
    @if (showNoResults) {
      <div class="search-no-results">
        <mat-icon>search_off</mat-icon>
        <span>No results found for "{{ searchControl.value }}"</span>
      </div>
    }
  </div>
