<div class="page-container">
  <!-- Consolidated Header -->
  <div class="form-header">
    <div class="header-content">
      <div class="title-section">
        <h1>
          {{ isRepeatMode ? 'Repeat Request For Quote (RFQ)' : 'Request For Quote (RFQ)' }}
        </h1>

        @if (!isRepeatMode) {
          <p class="form-instructions">
            Complete the form section by section. Click on a section header to expand it.
          </p>
        }

        @if (isRepeatMode) {
          <div class="repeat-notice">
            <mat-icon>refresh</mat-icon>
            <span>Based on submission #{{ originalSubmissionId?.split('-')?.[1] || originalSubmissionId }}</span>
          </div>
        }
      </div>

      <!-- Compact Company Selection -->
      @if (availableCompanies.length > 0) {
        <div class="company-selector-inline">
          <mat-form-field appearance="outline" class="company-field-compact">
            <mat-label>Company Configuration</mat-label>
            <mat-select
              [value]="selectedCompanyId"
              (selectionChange)="onCompanyChange($event.value)"
              placeholder="Default">
              <mat-option [value]="null">Default Configuration</mat-option>
              @for (company of availableCompanies; track company) {
                <mat-option [value]="company">{{ company }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          @if (currentFormConfig) {
            <div class="config-chips">
              <mat-chip-set>
                <mat-chip [disabled]="true">
                  <mat-icon matChipAvatar>settings</mat-icon>
                  {{ currentFormConfig.name }}
                </mat-chip>
                @if (currentFormConfig.companyId) {
                  <mat-chip [disabled]="true" color="primary">
                    <mat-icon matChipAvatar>business</mat-icon>
                    {{ currentFormConfig.companyId }}
                  </mat-chip>
                }
                @if (currentFormConfig.isDefault) {
                  <mat-chip [disabled]="true" color="accent">
                    <mat-icon matChipAvatar>star</mat-icon>
                    Default
                  </mat-chip>
                }
              </mat-chip-set>
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- Loading State (Compact) -->
  @if (isLoadingConfig) {
    <div class="loading-container-compact">
      <mat-spinner diameter="32"></mat-spinner>
      <span>Loading configuration...</span>
    </div>
  }

  <!-- Error State (Compact) -->
  @if (configLoadError && !isLoadingConfig) {
    <div class="error-container-compact">
      <mat-icon color="warn">error</mat-icon>
      <span>Configuration error. Using default.</span>
      <button mat-button class="get-started-btn" (click)="loadFormConfiguration()">
        <mat-icon>refresh</mat-icon>
        Retry
      </button>
    </div>
  }

  <!-- Form Content (Direct Integration) -->
  @if (!isLoadingConfig && rfqSections.length > 0) {
    <div class="form-content">
      <app-reusable-form
        [sections]="rfqSections"
        [multi]="false"
        [formTitle]=""
        [submitButtonText]="isRepeatMode ? 'Submit Repeated RFQ' : 'Submit RFQ'"
        [initialData]="isRepeatMode ? repeatedSubmissionData : initialFormData"
        (formSubmit)="onFormSubmit($event)"
        (formValueChange)="onFormValueChange($event)">
      </app-reusable-form>
    </div>
  }
</div>
